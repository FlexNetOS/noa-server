# Default values for noa-server
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 3

image:
  repository: noa-server/noa-server
  pullPolicy: IfNotPresent
  tag: 'latest'

imagePullSecrets: []
nameOverride: ''
fullnameOverride: ''

serviceAccount:
  create: true
  annotations: {}
  name: ''

podAnnotations:
  prometheus.io/scrape: 'true'
  prometheus.io/port: '8080'
  prometheus.io/path: '/metrics'

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

service:
  type: ClusterIP
  port: 3000
  targetPort: 3000
  annotations: {}

ingress:
  enabled: true
  className: 'nginx'
  annotations:
    cert-manager.io/cluster-issuer: 'letsencrypt-prod'
    nginx.ingress.kubernetes.io/ssl-redirect: 'true'
    nginx.ingress.kubernetes.io/force-ssl-redirect: 'true'
  hosts:
    - host: noa-server.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: noa-server-tls
      hosts:
        - noa-server.example.com

resources:
  limits:
    cpu: 1000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 1Gi

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - noa-server
          topologyKey: kubernetes.io/hostname

# PostgreSQL configuration
postgresql:
  enabled: true
  auth:
    username: noa
    password: '' # Set via secret
    database: noa_prod
  primary:
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi
    persistence:
      enabled: true
      size: 20Gi
      storageClass: 'fast-ssd'

# Redis configuration
redis:
  enabled: true
  auth:
    enabled: true
    password: '' # Set via secret
  master:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 200m
        memory: 512Mi
    persistence:
      enabled: true
      size: 10Gi

# MongoDB configuration
mongodb:
  enabled: true
  auth:
    enabled: true
    rootPassword: '' # Set via secret
    username: noa
    password: '' # Set via secret
    database: noa_prod
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 500m
      memory: 1Gi
  persistence:
    enabled: true
    size: 20Gi

# MCP Servers
mcpServers:
  filesystem:
    enabled: true
    replicaCount: 2
    image:
      repository: noa-server/mcp-server
      tag: 'latest'
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
    basePath: '/data'

  sqlite:
    enabled: true
    replicaCount: 2
    image:
      repository: noa-server/mcp-server
      tag: 'latest'
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
    dbPath: '/data/mcp.db'

  github:
    enabled: true
    replicaCount: 2
    image:
      repository: noa-server/mcp-server
      tag: 'latest'
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi
    token: '' # Set via secret

# Monitoring
monitoring:
  prometheus:
    enabled: true
    retention: 15d
    storageSize: 50Gi

  grafana:
    enabled: true
    adminPassword: '' # Set via secret

# Environment variables
env:
  NODE_ENV: 'production'
  LOG_LEVEL: 'info'
  # Database URLs set via secrets

# Secrets
secrets:
  createSecrets: true
  databaseUrl: ''
  redisUrl: ''
  mongodbUrl: ''
  githubToken: ''
  jwtSecret: ''

# Probes
livenessProbe:
  httpGet:
    path: /health
    port: 3000
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 3000
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# Network Policy
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress
