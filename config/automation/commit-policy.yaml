# Auto-Commit Policy Configuration
# Controls when and how automatic commits are created

# Global settings
enabled: true
dry_run: false  # Set to true to preview commits without creating them

# Commit triggers
triggers:
  post_agent_task:
    enabled: true
    min_changes: 1  # Minimum number of changed files
    skip_on_error: true
    skip_empty: true

  post_build:
    enabled: true
    only_on_success: true
    include_artifacts: true
    environments:
      - production
      - development

  post_test:
    enabled: true
    only_on_success: true
    min_coverage: 0  # Minimum coverage percentage
    include_coverage_reports: false  # Usually in .gitignore

  scheduled:
    enabled: false
    cron: "0 */6 * * *"  # Every 6 hours
    description: "Periodic auto-commit of accumulated changes"

# Commit message configuration
commit_message:
  # Use AI-powered message generation
  use_neural: true

  # Neural model settings
  neural:
    model_path: ""  # Auto-detect from LLM_MODEL_PATH
    max_tokens: 150
    temperature: 0.7
    context_size: 2048
    timeout_ms: 30000

  # Fallback to template if neural fails
  fallback_to_template: true

  # Template settings
  template:
    max_subject_length: 72
    include_task_id: true
    include_agent_type: true
    include_stats: true
    include_file_list: true
    max_files_in_list: 5

# Conventional Commits configuration
conventional_commits:
  types:
    - feat      # New feature
    - fix       # Bug fix
    - docs      # Documentation changes
    - style     # Code style changes (formatting, etc)
    - refactor  # Code refactoring
    - perf      # Performance improvements
    - test      # Test additions or updates
    - build     # Build system or dependency changes
    - ci        # CI/CD pipeline changes
    - chore     # Other changes
    - revert    # Revert previous commit

  # Auto-detect scope from file paths
  auto_scope: true

  scopes:
    src: "core"
    tests: "test"
    docs: "docs"
    scripts: "automation"
    config: "config"
    packages: "package"
    "*.sh": "scripts"
    "*.json": "config"
    "*.yaml": "config"

# Breaking change detection
breaking_changes:
  enabled: true

  # Patterns that indicate breaking changes
  patterns:
    - "BREAKING CHANGE"
    - "breaking:"
    - "removed.*function"
    - "removed.*class"
    - "removed.*api"
    - "incompatible"
    - "deprecated.*removed"

  # Require manual review for breaking changes
  require_manual_review: false

# File filtering
file_filters:
  # Always include these patterns
  include:
    - "src/**"
    - "tests/**"
    - "docs/**"
    - "scripts/**"
    - "config/**"
    - "*.md"
    - "*.json"
    - "*.yaml"
    - "*.sh"

  # Always exclude these patterns
  exclude:
    - "node_modules/**"
    - ".git/**"
    - "*.log"
    - ".env"
    - ".env.*"
    - "credentials.*"
    - "secrets.*"
    - "*.key"
    - "*.pem"
    - ".DS_Store"
    - "Thumbs.db"
    - "coverage/**"
    - "dist/**"
    - "build/**"

  # Max file size (in KB) to include in commits
  max_file_size_kb: 1024

# Agent attribution
agent_attribution:
  enabled: true

  # Co-author format
  format: "Co-Authored-By: {name} <{email}>"

  # Agent email domain
  email_domain: "claude-code.anthropic.com"

  # Known agents
  agents:
    coder:
      name: "Coder"
      email: "coder@claude-code.anthropic.com"
    tester:
      name: "Test-Agent"
      email: "test@claude-code.anthropic.com"
    reviewer:
      name: "Reviewer"
      email: "reviewer@claude-code.anthropic.com"
    build:
      name: "Build-Agent"
      email: "build@claude-code.anthropic.com"
    cicd:
      name: "CICD-Agent"
      email: "cicd@claude-code.anthropic.com"

# Git configuration
git:
  # Auto-stage all changes before commit
  auto_stage: true

  # Skip git hooks (use with caution)
  skip_hooks: false

  # GPG signing
  gpg_sign: false

  # Push after commit
  auto_push:
    enabled: false
    remote: "origin"
    branch: "main"

# Notifications
notifications:
  # Notify via claude-flow hooks
  claude_flow:
    enabled: true
    on_success: true
    on_failure: true

  # Webhook notifications
  webhook:
    enabled: false
    url: ""
    on_success: true
    on_failure: true

# Safety features
safety:
  # Require confirmation for large changes
  confirm_large_changes:
    enabled: false
    threshold_files: 50
    threshold_lines: 1000

  # Prevent commits to protected branches
  protected_branches:
    enabled: true
    branches:
      - main
      - master
      - production
    action: "warn"  # "warn" or "block"

  # Backup before commit
  backup:
    enabled: false
    path: ".git/auto-commit-backups"

# Logging
logging:
  enabled: true
  level: "info"  # debug, info, warn, error
  file: "logs/auto-commit.log"
  rotate: true
  max_size_mb: 10
  max_files: 5

# Integration
integration:
  # Claude Flow integration
  claude_flow:
    enabled: true
    hooks:
      - pre-task
      - post-task
      - post-edit

  # GitHub Actions integration
  github_actions:
    enabled: false
    workflow_dispatch: false

  # GitLab CI integration
  gitlab_ci:
    enabled: false

# Maintenance
maintenance:
  # Clean up old auto-commits
  cleanup:
    enabled: false
    older_than_days: 30
    squash: true

  # Generate commit report
  reporting:
    enabled: true
    interval: "weekly"
    format: "markdown"
    output: "docs/automation/commit-report.md"
